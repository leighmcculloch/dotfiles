#!/usr/bin/env zsh

set -o nounset

# Launch GitHub Copilot CLI with pre-approved permissions
# Mirrors the permissions from Claude Code settings.json

export GIT_CONFIG_COUNT=1
export GIT_CONFIG_KEY_0="commit.gpgsign"
export GIT_CONFIG_VALUE_0="false"

exec "$BREW_PREFIX/bin/copilot" \
  \
  `# === URL Permissions ===` \
  --allow-url developers.stellar.org \
  --allow-url github.com \
  --allow-url api.github.com \
  --allow-url raw.githubusercontent.com \
  --allow-url results-receiver.actions.githubusercontent.com \
  --allow-url crates.io \
  --allow-url static.crates.io \
  --allow-url index.crates.io \
  --allow-url docs.rs \
  --allow-url doc.rust-lang.org \
  --allow-url rust-lang.org \
  --allow-url pkg.go.dev \
  --allow-url go.dev \
  --allow-url golang.org \
  --allow-url deno.land \
  --allow-url docs.deno.com \
  --allow-url jsr.io \
  --allow-url developer.mozilla.org \
  --allow-url npmjs.com \
  --allow-url nodejs.org \
  --allow-url stellar.org \
  --allow-url soroban.stellar.org \
  --allow-url horizon.stellar.org \
  --allow-url docs.github.com \
  --allow-url lib.rs \
  --allow-url socket.dev \
  \
  `# === Git Commands ===` \
  --allow-tool 'shell(git fetch)' \
  --allow-tool 'shell(git grep)' \
  --allow-tool 'shell(git diff)' \
  --allow-tool 'shell(git log)' \
  --allow-tool 'shell(git show)' \
  --allow-tool 'shell(git branch)' \
  --allow-tool 'shell(git remote)' \
  --allow-tool 'shell(git tag)' \
  --allow-tool 'shell(git config --get)' \
  --allow-tool 'shell(git config --list)' \
  --allow-tool 'shell(git rev-parse)' \
  --allow-tool 'shell(git describe)' \
  --allow-tool 'shell(git blame)' \
  --allow-tool 'shell(git add)' \
  --allow-tool 'shell(git commit)' \
  --allow-tool 'shell(git status)' \
  \
  `# === Blocked Git Commands ===` \
  --deny-tool 'shell(git push --force)' \
  --deny-tool 'shell(git push -f)' \
  --deny-tool 'shell(git push --force-with-lease)' \
  --deny-tool 'shell(git commit --amend)' \
  \
  `# === GitHub CLI ===` \
  --allow-tool 'shell(gh pr view)' \
  --allow-tool 'shell(gh pr checks)' \
  --allow-tool 'shell(gh pr diff)' \
  --allow-tool 'shell(gh pr list)' \
  --allow-tool 'shell(gh pr status)' \
  --allow-tool 'shell(gh issue view)' \
  --allow-tool 'shell(gh issue list)' \
  --allow-tool 'shell(gh issue status)' \
  --allow-tool 'shell(gh repo view)' \
  --allow-tool 'shell(gh repo list)' \
  --allow-tool 'shell(gh repo clone)' \
  --allow-tool 'shell(gh run view)' \
  --allow-tool 'shell(gh run list)' \
  --allow-tool 'shell(gh run watch)' \
  --allow-tool 'shell(gh workflow list)' \
  --allow-tool 'shell(gh workflow view)' \
  --allow-tool 'shell(gh release view)' \
  --allow-tool 'shell(gh release list)' \
  --allow-tool 'shell(gh browse)' \
  --allow-tool 'shell(gh search)' \
  --allow-tool 'shell(gh gist view)' \
  --allow-tool 'shell(gh gist list)' \
  \
  `# === Rust/Cargo ===` \
  --allow-tool 'shell(cargo --version)' \
  --allow-tool 'shell(cargo check)' \
  --allow-tool 'shell(cargo doc)' \
  --allow-tool 'shell(cargo init)' \
  --allow-tool 'shell(cargo update)' \
  --allow-tool 'shell(cargo build)' \
  --allow-tool 'shell(cargo test)' \
  --allow-tool 'shell(cargo tree)' \
  --allow-tool 'shell(cargo metadata)' \
  --allow-tool 'shell(cargo pkgid)' \
  --allow-tool 'shell(cargo verify-project)' \
  --allow-tool 'shell(cargo info)' \
  --allow-tool 'shell(rustc --version)' \
  --allow-tool 'shell(rustfmt)' \
  \
  `# === Go ===` \
  --allow-tool 'shell(go build)' \
  --allow-tool 'shell(go test)' \
  --allow-tool 'shell(go mod tidy)' \
  --allow-tool 'shell(go get)' \
  --allow-tool 'shell(go list)' \
  --allow-tool 'shell(go doc)' \
  --allow-tool 'shell(go vet)' \
  --allow-tool 'shell(go version)' \
  --allow-tool 'shell(go env)' \
  --allow-tool 'shell(go mod graph)' \
  --allow-tool 'shell(go mod why)' \
  --allow-tool 'shell(gofmt)' \
  \
  `# === Deno ===` \
  --allow-tool 'shell(deno add)' \
  --allow-tool 'shell(deno check)' \
  --allow-tool 'shell(deno doc)' \
  --allow-tool 'shell(deno info)' \
  --allow-tool 'shell(deno run)' \
  --allow-tool 'shell(deno task)' \
  --allow-tool 'shell(deno test)' \
  --allow-tool 'shell(deno --version)' \
  \
  `# === Node/NPM ===` \
  --allow-tool 'shell(npm list)' \
  --allow-tool 'shell(npm view)' \
  --allow-tool 'shell(npm search)' \
  --allow-tool 'shell(npm outdated)' \
  --allow-tool 'shell(npm config list)' \
  --allow-tool 'shell(npm config get)' \
  --allow-tool 'shell(npm explain)' \
  --allow-tool 'shell(npm ls)' \
  --allow-tool 'shell(npm why)' \
  --allow-tool 'shell(node --version)' \
  \
  `# === Unix Utilities ===` \
  --allow-tool 'shell(curl)' \
  --allow-tool 'shell(grep)' \
  --allow-tool 'shell(ls)' \
  --allow-tool 'shell(mkdir)' \
  --allow-tool 'shell(touch)' \
  --allow-tool 'shell(cat)' \
  --allow-tool 'shell(head)' \
  --allow-tool 'shell(tail)' \
  --allow-tool 'shell(wc)' \
  --allow-tool 'shell(find)' \
  --allow-tool 'shell(which)' \
  --allow-tool 'shell(whereis)' \
  --allow-tool 'shell(diff)' \
  --allow-tool 'shell(sort)' \
  --allow-tool 'shell(uniq)' \
  --allow-tool 'shell(cut)' \
  --allow-tool 'shell(jq)' \
  --allow-tool 'shell(yq)' \
  --allow-tool 'shell(tree)' \
  --allow-tool 'shell(stat)' \
  --allow-tool 'shell(file)' \
  --allow-tool 'shell(realpath)' \
  --allow-tool 'shell(dirname)' \
  --allow-tool 'shell(basename)' \
  --allow-tool 'shell(pwd)' \
  --allow-tool 'shell(date)' \
  --allow-tool 'shell(uname)' \
  --allow-tool 'shell(du)' \
  --allow-tool 'shell(df)' \
  \
  `# === Stellar Tools ===` \
  --allow-tool 'shell(stellar version)' \
  --allow-tool 'shell(stellar xdr decode)' \
  --allow-tool 'shell(stellar xdr types)' \
  --allow-tool 'shell(stellar network list)' \
  --allow-tool 'shell(stellar keys address)' \
  --allow-tool 'shell(stellar keys ls)' \
  --allow-tool 'shell(stellar contract info)' \
  --allow-tool 'shell(stellar contract read)' \
  --allow-tool 'shell(stellar-xdr)' \
  --allow-tool 'shell(stellar-strkey)' \
  \
  `# === Mermaid Diagrams ===` \
  --allow-tool 'shell(mmdc)' \
  --allow-tool 'shell(open)' \
  \
  "$@"
